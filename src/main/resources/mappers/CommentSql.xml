<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.comment.CommentMapper">
	<!-- 댓글삽입 -->
	<insert id="insert_comment" parameterType="CMDTO">
		insert into comment (pnum, writer, content, writetime, grp, grph, grps) 
		values (#{pnum}, #{writer}, #{content}, now(), #{grp}, #{grph}, #{grps})
	</insert>
	
	<!-- num최댓값 -->
	<select id="select_maxNum" resultType="int">
		select ifnull(max(num),0) from comment
	</select>
	
	<!-- 댓글리스트 -->
	<select id="get_comment_list" parameterType="String" resultType="CMDTO">
		select * from comment where pnum = #{pnum} order by fix desc, grp desc, grph asc; 
	</select>
	
	<!-- 부모 댓글에 자식 댓글추가시 최근자식 댓글을 상단으로 이동시키기 -->
	<update id="change_hierarchy" parameterType="int">
		update comment set grph = grph + 1 where grp = #{grp} and grph > #{grph}
	</update>
	
	
	
	<!-- 댓글수정 -->
	<update id="update_comment" parameterType="String">
		update comment set content = #{content} where num = #{num}
	</update>
	<!-- 부모댓글 등록 -->
	<update id="update_parent" parameterType="String">
		update comment set parent = #{parent} where num = #{num}
	</update>
	<!-- 자식댓글만 삭제 -->
	<delete id="delete_comment" parameterType="String">
		delete from comment where num = #{num}
	</delete>
	<!-- 부모댓글삭제시 자식댓글도 같이 삭제  -->
	<delete id="delete_branch_comment" parameterType="String">
		delete from comment where grp = #{grp}
	</delete>
	
	<!-- 댓글고정 -->
	<!-- 전체초기화 -->
	<update id="rest_fix">
		update comment set fix = 0;
	</update>
	<!-- 고정글만 1로변경 -->
	<update id="fix_comment" parameterType="String">
		update comment set fix = 1 where num = #{num}
	</update>
	<!-- 댓글고정 취소 -->
	<update id="cancel_fix" parameterType="String">
		update comment set fix = 0 where num = #{num}
	</update>
</mapper>